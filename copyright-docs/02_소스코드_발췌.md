# 프로그램 소스코드 발췌

**프로그램 명칭**: NFT 미술품 5개 모듈 통합 가치산정 시스템  
**저작자**: 남현우 (서경대학교 교수)  
**제출 일자**: 2025년 11월 26일

---

## 목차

1. 핵심 알고리즘 소스코드
2. 데이터 타입 정의
3. 유틸리티 함수
4. API 엔드포인트

---

## 1. 핵심 알고리즘 소스코드

### 파일: src/types.ts

```typescript
// ============================================
// NFT 미술품 5개 모듈 통합 가치산정 시스템
// Copyright (c) 2025 Hyunwoo Nam. All rights reserved.
// ============================================

// 작품 타입 정의
export interface Artwork {
  id: number;
  artist_id: number;
  title: string;
  description?: string;
  category: string;
  
  // 모듈 1: 작가 업적 평가
  artist_achievement_score: number;
  
  // 모듈 2: 작품 내용 평가 (4가지 지표)
  content_depth_score: number;        // 내용성
  expression_score: number;           // 표현성
  originality_innovation_score: number; // 독창성
  collection_value_score: number;     // 소장가치
  
  // 모듈 3: 저작권/소유권/라이선스 인증
  blockchain_hash?: string;
  copyright_registration_number?: string;
  license_type: string;
  certification_score: number;
  
  // 모듈 4: 전문가 정성 평가
  expert_evaluation_final_score: number;
  
  // 모듈 5: 대중 인지도/인기도
  youtube_views: number;
  instagram_engagement: number;
  platform_likes: number;
  google_trends_score: number;
  media_coverage_count: number;
  popularity_score: number;
  
  // 5개 모듈 최종 점수
  artist_achievement_final_score: number;
  artwork_content_final_score: number;
  certification_final_score: number;
  
  // 가중치 (α1~α5, 합=1)
  weight_artist: number;      // α1
  weight_artwork: number;     // α2
  weight_certification: number; // α3
  weight_expert: number;      // α4
  weight_popularity: number;  // α5
  
  // 최종 가치
  final_value_score: number;
  estimated_value: number;
  min_price: number;
  current_price: number;
}

// ============================================
// 모듈 1: 작가 업적 점수 계산
// ============================================
export function calculateArtistAchievement(artist: Partial<Artist>): number {
  const currentYear = new Date().getFullYear();
  
  // 1. 전시 경력 점수
  const soloExhibitionScore = (artist.solo_exhibitions_count || 0) * 10;
  const groupExhibitionScore = (artist.group_exhibitions_count || 0) * 5;
  
  // 2. 수상 경력 점수 (권위도 가중치 적용)
  const authorityWeight = 1.0; // 기본 가중치
  const awardsScore = (artist.awards_count || 0) * 15 * authorityWeight;
  
  // 3. 경력 년수 점수 (제곱근 적용으로 초기 년도 가중)
  const careerScore = Math.sqrt(artist.career_years || 1) * 5;
  
  // 4. 최근 활동도 보너스 (최근 2년 이내 활동 시)
  const latestYear = artist.latest_exhibition_year || 0;
  const recentBonus = (currentYear - latestYear <= 2) ? 10 : 0;
  
  // 5. 합산 및 정규화 (0~100 범위)
  const rawScore = soloExhibitionScore + groupExhibitionScore + 
                   awardsScore + careerScore + recentBonus;
  
  const normalizedScore = Math.min(100, (rawScore / 150) * 100);
  
  return Math.round(normalizedScore * 10) / 10; // 소수점 1자리
}

// ============================================
// 모듈 2: 작품 내용 점수 계산
// ============================================
export function calculateArtworkContent(artwork: Partial<Artwork>): number {
  // 4가지 핵심 지표 (각 0~100점)
  const contentDepth = artwork.content_depth_score || 0;      // 내용성
  const expression = artwork.expression_score || 0;           // 표현성
  const originality = artwork.originality_innovation_score || 0; // 독창성
  const collectionValue = artwork.collection_value_score || 0;   // 소장가치
  
  // 4개 지표의 평균값
  const averageScore = (contentDepth + expression + originality + collectionValue) / 4;
  
  return Math.round(averageScore * 10) / 10;
}

// ============================================
// 모듈 3: 저작권/인증 점수 계산
// ============================================
export function calculateCertification(artwork: Partial<Artwork>): number {
  let score = 0;
  
  // 1. 블록체인 해시 존재 여부 (30점)
  if (artwork.blockchain_hash) {
    score += 30;
  }
  
  // 2. 저작권 등록 번호 존재 여부 (25점)
  if (artwork.copyright_registration_number) {
    score += 25;
  }
  
  // 3. 라이선스 유형 평가 (25점)
  if (artwork.license_type === 'exclusive') {
    score += 25;
  } else if (artwork.license_type === 'non-exclusive') {
    score += 15;
  } else if (artwork.license_type === 'creative-commons') {
    score += 10;
  }
  
  // 4. IPFS 저장 여부 (20점)
  if (artwork.ipfs_hash) {
    score += 20;
  }
  
  return Math.min(100, score);
}

// ============================================
// 모듈 4: 전문가 정성 평가 점수 집계
// ============================================
export function calculateExpertEvaluation(
  evaluations: ExpertEvaluation[]
): number {
  if (!evaluations || evaluations.length === 0) {
    return 0;
  }
  
  // 전문가 레벨별 가중치
  const levelWeights = {
    'curator': 2.5,      // 큐레이터
    'director': 3.0,     // 미술관장
    'critic': 2.0,       // 미술평론가
    'phd': 1.5           // 박사
  };
  
  let totalWeightedScore = 0;
  let totalWeight = 0;
  
  // 각 전문가 평가를 가중치와 함께 합산
  evaluations.forEach(evaluation => {
    const weight = levelWeights[evaluation.expert_level] || 1.0;
    totalWeightedScore += evaluation.overall_score * weight;
    totalWeight += weight;
  });
  
  // 가중 평균 계산
  const averageScore = totalWeight > 0 ? totalWeightedScore / totalWeight : 0;
  
  return Math.round(averageScore * 10) / 10;
}

// ============================================
// 모듈 5: 대중 인지도 점수 계산
// ============================================
export function calculatePopularity(artwork: Partial<Artwork>): number {
  // 로그 스케일 적용 (큰 숫자 차이를 완화)
  const youtubeScore = Math.log10((artwork.youtube_views || 0) + 1) * 8;
  const instagramScore = Math.log10((artwork.instagram_engagement || 0) + 1) * 8;
  const likesScore = Math.log10((artwork.platform_likes || 0) + 1) * 6;
  const commentsScore = Math.log10((artwork.platform_comments || 0) + 1) * 5;
  const sharesScore = Math.log10((artwork.platform_shares || 0) + 1) * 7;
  
  // Google Trends 점수 (0~100) 직접 사용
  const trendsScore = (artwork.google_trends_score || 0) * 0.3;
  
  // 언론 보도 점수 (건당 5점, 최대 30점)
  const mediaScore = Math.min(30, (artwork.media_coverage_count || 0) * 5);
  
  // 전체 합산
  const totalScore = youtubeScore + instagramScore + likesScore + 
                     commentsScore + sharesScore + trendsScore + mediaScore;
  
  // 0~100 범위로 제한
  return Math.min(100, totalScore);
}

// ============================================
// 최종 통합: 5개 모듈 가중치 계산
// ============================================
export function calculateArtworkValue(artwork: Partial<Artwork>): {
  finalScore: number;
  estimatedValue: number;
  minPrice: number;
  maxPrice: number;
  moduleContributions: {
    artist: number;
    content: number;
    certification: number;
    expert: number;
    popularity: number;
  };
} {
  // 5개 모듈 점수 추출
  const M1 = artwork.artist_achievement_final_score || 0;
  const M2 = artwork.artwork_content_final_score || 0;
  const M3 = artwork.certification_final_score || 0;
  const M4 = artwork.expert_evaluation_final_score || 0;
  const M5 = artwork.popularity_final_score || 0;
  
  // 가중치 (기본값: α1=0.20, α2=0.30, α3=0.15, α4=0.25, α5=0.10)
  const alpha1 = artwork.weight_artist || 0.20;
  const alpha2 = artwork.weight_artwork || 0.30;
  const alpha3 = artwork.weight_certification || 0.15;
  const alpha4 = artwork.weight_expert || 0.25;
  const alpha5 = artwork.weight_popularity || 0.10;
  
  // 가중치 합이 1인지 검증
  const weightSum = alpha1 + alpha2 + alpha3 + alpha4 + alpha5;
  if (Math.abs(weightSum - 1.0) > 0.01) {
    console.warn('Warning: Weight sum is not 1.0:', weightSum);
  }
  
  // 최종 점수 계산 (0~100)
  const finalScore = alpha1 * M1 + alpha2 * M2 + alpha3 * M3 + 
                     alpha4 * M4 + alpha5 * M5;
  
  // 각 모듈의 기여도
  const moduleContributions = {
    artist: alpha1 * M1,
    content: alpha2 * M2,
    certification: alpha3 * M3,
    expert: alpha4 * M4,
    popularity: alpha5 * M5
  };
  
  // 작가 등급 계수 결정
  let artistGradeCoefficient = 50; // 기본값: 중견 작가
  
  if (M1 >= 90) {
    artistGradeCoefficient = 1000; // 거장
  } else if (M1 >= 70) {
    artistGradeCoefficient = 200; // 유명 작가
  } else if (M1 >= 50) {
    artistGradeCoefficient = 50; // 중견 작가
  } else {
    artistGradeCoefficient = 10; // 신진 작가
  }
  
  // 작품 크기 계수
  const width = artwork.size_width || 50; // cm
  const height = artwork.size_height || 50; // cm
  const sizeArea = (width * height) / 10000; // cm² → m²
  const sizeCoefficient = 1 + Math.log10(sizeArea + 1);
  
  // 기본 가격 계산 (USD)
  const basePrice = finalScore * artistGradeCoefficient * sizeCoefficient;
  
  // 시장 조정 계수 (카테고리별 인기도)
  const marketAdjustment = 1.2; // 기본 20% 가산
  
  // 최종 추정 가치
  const estimatedValue = basePrice * marketAdjustment;
  
  // 권장 가격 범위
  const minPrice = estimatedValue * 0.7;  // -30%
  const maxPrice = estimatedValue * 1.3;  // +30%
  
  return {
    finalScore: Math.round(finalScore * 10) / 10,
    estimatedValue: Math.round(estimatedValue),
    minPrice: Math.round(minPrice),
    maxPrice: Math.round(maxPrice),
    moduleContributions
  };
}

// ============================================
// 가중치 조정 함수 (작가 유형별)
// ============================================
export function adjustWeights(artistType: 'emerging' | 'mid-career' | 'established'): {
  weight_artist: number;
  weight_artwork: number;
  weight_certification: number;
  weight_expert: number;
  weight_popularity: number;
} {
  switch (artistType) {
    case 'emerging': // 신진 작가
      return {
        weight_artist: 0.10,      // 업적 가중치 감소
        weight_artwork: 0.40,     // 작품 내용 가중치 증가
        weight_certification: 0.15,
        weight_expert: 0.25,
        weight_popularity: 0.10
      };
      
    case 'mid-career': // 중견 작가
      return {
        weight_artist: 0.20,
        weight_artwork: 0.30,
        weight_certification: 0.15,
        weight_expert: 0.25,
        weight_popularity: 0.10
      };
      
    case 'established': // 유명 작가
      return {
        weight_artist: 0.30,      // 업적 가중치 증가
        weight_artwork: 0.20,
        weight_certification: 0.10,
        weight_expert: 0.25,
        weight_popularity: 0.15   // 인지도 가중치 증가
      };
      
    default:
      return {
        weight_artist: 0.20,
        weight_artwork: 0.30,
        weight_certification: 0.15,
        weight_expert: 0.25,
        weight_popularity: 0.10
      };
  }
}

// ============================================
// 신뢰도 계산 함수
// ============================================
export function calculateConfidenceLevel(artwork: Partial<Artwork>): number {
  let confidence = 0.5; // 기본 신뢰도 50%
  
  // 데이터 완전성 평가
  if (artwork.blockchain_hash) confidence += 0.10;
  if (artwork.copyright_registration_number) confidence += 0.10;
  if (artwork.expert_evaluation_final_score > 0) confidence += 0.15;
  if (artwork.youtube_views > 1000) confidence += 0.05;
  if (artwork.platform_likes > 100) confidence += 0.05;
  if (artwork.media_coverage_count > 0) confidence += 0.05;
  
  return Math.min(1.0, confidence); // 최대 100%
}

// ============================================
// 등급 산정 함수
// ============================================
export function getGrade(finalScore: number): string {
  if (finalScore >= 90) return 'S';  // 최고 등급
  if (finalScore >= 80) return 'A';  // 우수
  if (finalScore >= 70) return 'B';  // 양호
  if (finalScore >= 60) return 'C';  // 보통
  if (finalScore >= 50) return 'D';  // 미흡
  return 'F';  // 저조
}
```

---

## 2. 데이터 타입 정의

```typescript
// 작가 타입
export interface Artist {
  id: number;
  name: string;
  email?: string;
  bio?: string;
  career_years: number;
  education?: string;
  exhibitions_count: number;
  awards_count: number;
  solo_exhibitions_count: number;
  group_exhibitions_count: number;
  competition_awards_count: number;
  achievement_score: number;
  latest_exhibition_year: number;
  latest_award_year: number;
  profile_image?: string;
  wallet_address?: string;
  created_at: string;
  updated_at: string;
}

// 전문가 평가
export interface ExpertEvaluation {
  id: number;
  artwork_id: number;
  expert_name: string;
  expert_level: 'curator' | 'director' | 'critic' | 'phd';
  expert_institution?: string;
  
  // 4가지 평가 지표
  technique_mastery_score: number;           // 기법 숙련도
  art_historical_significance_score: number; // 미술사적 의미
  marketability_score: number;               // 시장성
  development_potential_score: number;       // 발전 가능성
  
  overall_score: number;
  evaluation_comment?: string;
  evaluated_at: string;
}

// API 응답 타입
export interface ApiResponse<T = any> {
  success: boolean;
  data?: T;
  error?: string;
  message?: string;
}
```

---

## 3. 유틸리티 함수

```typescript
// 점수 정규화 함수 (0~100 범위로)
export function normalizeScore(score: number, min: number = 0, max: number = 100): number {
  return Math.max(min, Math.min(max, score));
}

// 로그 스케일 점수 계산
export function logScale(value: number, coefficient: number = 10): number {
  return Math.log10(value + 1) * coefficient;
}

// 백분위 계산
export function calculatePercentile(scores: number[], value: number): number {
  const sorted = scores.sort((a, b) => a - b);
  const index = sorted.findIndex(s => s >= value);
  return (index / sorted.length) * 100;
}
```

---

## 4. API 엔드포인트 (예시)

```typescript
// 가치 평가 API
app.post('/api/valuation/calculate', async (c) => {
  try {
    const artwork = await c.req.json();
    
    // 5개 모듈 점수 계산
    const artistScore = calculateArtistAchievement(artwork.artist);
    const contentScore = calculateArtworkContent(artwork);
    const certificationScore = calculateCertification(artwork);
    const expertScore = calculateExpertEvaluation(artwork.evaluations);
    const popularityScore = calculatePopularity(artwork);
    
    // 최종 통합 계산
    const result = calculateArtworkValue({
      ...artwork,
      artist_achievement_final_score: artistScore,
      artwork_content_final_score: contentScore,
      certification_final_score: certificationScore,
      expert_evaluation_final_score: expertScore,
      popularity_final_score: popularityScore
    });
    
    // 신뢰도 및 등급
    const confidence = calculateConfidenceLevel(artwork);
    const grade = getGrade(result.finalScore);
    
    return c.json({
      success: true,
      data: {
        ...result,
        grade,
        confidence,
        timestamp: new Date().toISOString()
      }
    });
    
  } catch (error) {
    return c.json({
      success: false,
      error: error.message
    }, 500);
  }
});
```

---

**소스코드 발췌 끝**

---

**저작권 안내**: 본 소스코드는 저작권법에 의해 보호받는 저작물입니다.  
무단 복제, 배포, 수정을 금지하며, 상업적 이용 시 저작자의 서면 동의가 필요합니다.

**저작자**: 남현우 (서경대학교 교수)  
**저작권 등록**: 한국저작권위원회 (신청 중)  
**제출일**: 2025년 11월 26일
