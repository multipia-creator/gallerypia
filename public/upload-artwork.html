<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>작품 업로드 - GALLERYPIA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-black text-white">
    <div class="min-h-screen py-20 px-4">
        <div class="max-w-3xl mx-auto">
            <a href="/dashboard" class="inline-flex items-center text-gray-400 hover:text-white mb-8">
                <i class="fas fa-arrow-left mr-2"></i> 대시보드로
            </a>
            
            <h1 class="text-4xl font-bold mb-8">작품 업로드</h1>
            
            <form id="uploadForm" class="space-y-8">
                <div class="bg-gray-900 rounded-xl p-8 border border-gray-800">
                    <h2 class="text-xl font-bold mb-4">이미지 업로드</h2>
                    <div id="dropzone" class="border-2 border-dashed border-gray-700 rounded-xl p-12 text-center cursor-pointer hover:border-purple-500 transition-colors">
                        <i class="fas fa-cloud-upload-alt text-6xl text-gray-600 mb-4"></i>
                        <p class="text-gray-400 mb-2">이미지를 드래그하거나 클릭하여 업로드</p>
                        <input type="file" id="imageInput" accept="image/*" class="hidden">
                        <button type="button" onclick="document.getElementById('imageInput').click()" class="mt-4 px-6 py-3 bg-purple-500 rounded-xl">파일 선택</button>
                    </div>
                    <div id="preview" class="mt-6 hidden">
                        <img id="previewImage" class="w-full max-h-96 object-contain rounded-xl">
                    </div>
                </div>
                
                <div class="bg-gray-900 rounded-xl p-8 border border-gray-800">
                    <h2 class="text-xl font-bold mb-4">작품 정보</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-400 mb-2">작품 제목 *</label>
                            <input type="text" id="title" required class="w-full bg-gray-800 rounded-xl px-4 py-3 border border-gray-700 focus:border-purple-500">
                        </div>
                        <div>
                            <label class="block text-gray-400 mb-2">설명</label>
                            <textarea id="description" rows="4" class="w-full bg-gray-800 rounded-xl px-4 py-3 border border-gray-700 focus:border-purple-500"></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-400 mb-2">카테고리 *</label>
                                <select id="category" required class="w-full bg-gray-800 rounded-xl px-4 py-3 border border-gray-700">
                                    <option value="">선택하세요</option>
                                    <option value="painting">회화</option>
                                    <option value="sculpture">조각</option>
                                    <option value="photography">사진</option>
                                    <option value="digital">디지털아트</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-400 mb-2">가격 (ETH) *</label>
                                <input type="number" id="price" step="0.01" min="0" required class="w-full bg-gray-800 rounded-xl px-4 py-3 border border-gray-700">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-4">
                    <button type="submit" class="flex-1 py-4 bg-gradient-to-r from-purple-500 to-cyan-500 rounded-xl font-bold text-lg hover:scale-105 transition-transform">
                        <i class="fas fa-check mr-2"></i>업로드
                    </button>
                    <a href="/dashboard" class="px-8 py-4 bg-gray-800 rounded-xl font-bold hover:bg-gray-700 flex items-center">취소</a>
                </div>
            </form>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script>
        const imageInput = document.getElementById('imageInput');
        const preview = document.getElementById('preview');
        const previewImage = document.getElementById('previewImage');
        const dropzone = document.getElementById('dropzone');
        
        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewImage.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        });
        
        dropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropzone.classList.add('border-purple-500');
        });
        
        dropzone.addEventListener('dragleave', () => {
            dropzone.classList.remove('border-purple-500');
        });
        
        dropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropzone.classList.remove('border-purple-500');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                imageInput.files = e.dataTransfer.files;
                imageInput.dispatchEvent(new Event('change'));
            }
        });
        
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const token = localStorage.getItem('auth_token');
            if (!token) {
                alert('로그인이 필요합니다');
                window.location.href = '/login';
                return;
            }
            
            const formData = new FormData();
            formData.append('image', imageInput.files[0]);
            formData.append('title', document.getElementById('title').value);
            formData.append('description', document.getElementById('description').value);
            formData.append('category', document.getElementById('category').value);
            formData.append('current_price', document.getElementById('price').value);
            
            try {
                const response = await axios.post('/api/artworks', formData, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'multipart/form-data'
                    }
                });
                
                alert('작품이 업로드되었습니다!');
                window.location.href = `/artwork/${response.data.id}`;
            } catch (error) {
                console.error(error);
                alert('업로드 실패: ' + (error.response?.data?.error || '다시 시도해주세요'));
            }
        });
    </script>
</body>
</html>
